---
title: Interfaces & Types
description: Complete TypeScript interface definitions and type declarations for the IINA Plugin Bookmarks system
icon: FileType
---

import { Callout } from 'fumadocs-ui/components/callout';
import { Tabs, Tab } from 'fumadocs-ui/components/tabs';
import { Card, Cards } from 'fumadocs-ui/components/card';

# TypeScript Interfaces & Types

Complete reference for all TypeScript interfaces, types, and data structures used throughout the IINA Plugin Bookmarks system.

## üèóÔ∏è Core Data Structures

<Tabs items={['BookmarkData', 'Export/Import', 'Configuration', 'Performance']}>
  <Tab value="BookmarkData">
    ### `BookmarkData` Interface
    
    The primary data structure representing a single bookmark entry.
    
    ```typescript
    interface BookmarkData {
      id: string;                    // Unique identifier: "bookmark_${timestamp}_${hash}"
      title: string;                 // Display title (user-defined or auto-detected)
      timestamp: number;             // Playback position in seconds (precision: 0.1s)
      description?: string;          // Optional user description
      tags?: string[];              // Array of tag strings
      filepath: string;             // Absolute path to media file
      filename: string;             // Media filename without path
      createdAt: string;            // ISO 8601 timestamp of creation
      lastModified?: string;        // ISO 8601 timestamp of last modification
      
      // Metadata (auto-populated)
      metadata?: {
        duration?: number;          // Total media duration in seconds
        fileSize?: number;          // File size in bytes
        mediaType?: string;         // MIME type or file extension
        resolution?: {              // Video resolution
          width: number;
          height: number;
        };
        bitrate?: number;           // Media bitrate in kbps
        frameRate?: number;         // Video frame rate
        audioTracks?: number;       // Number of audio tracks
        subtitleTracks?: number;    // Number of subtitle tracks
      };
      
      // Performance tracking
      accessCount?: number;         // Number of times bookmark was accessed
      lastAccessed?: string;        // ISO 8601 timestamp of last access
    }
    ```
    
    **Field Details:**
    
    <Card title="ID Generation" icon="Hash">
      IDs are generated using the pattern: `bookmark_${Date.now()}_${generateHash()}`
      
      - **Timestamp component**: Ensures chronological ordering
      - **Hash component**: Prevents collisions within same millisecond
      - **Format**: `bookmark_1695740123456_a1b2c3d4`
    </Card>
    
    <Card title="Timestamp Precision" icon="Clock">
      Timestamps represent playback position with 0.1 second precision
      
      - **Storage**: JavaScript `number` type (IEEE 754 double precision)
      - **Range**: 0 to media duration
      - **Precision**: Up to 1 decimal place (e.g., `1234.5`)
    </Card>
    
    <Card title="File Path Handling" icon="Folder">
      File paths are normalized and validated on creation
      
      - **Format**: Absolute paths with forward slashes
      - **Normalization**: Resolves relative paths and symbolic links
      - **Validation**: Ensures file exists and is accessible
    </Card>
  </Tab>
  
  <Tab value="Export/Import">
    ### Export/Import Interfaces
    
    #### `ExportOptions` Interface
    
    Configuration for bookmark export operations.
    
    ```typescript
    interface ExportOptions {
      format: 'json' | 'csv';                    // Output format
      includeMetadata: boolean;                  // Include auto-detected metadata
      compressOutput?: boolean;                  // Enable gzip compression
      filePath?: string;                         // Custom output file path
      
      // Advanced filtering
      filter?: {
        tags?: string[];                         // Filter by tags (OR logic)
        dateRange?: {                           // Filter by creation date
          start: string;                        // ISO 8601 start date
          end: string;                          // ISO 8601 end date
        };
        mediaType?: string;                     // Filter by media type/extension
        filePattern?: string;                   // Regex pattern for file paths
        minDuration?: number;                   // Minimum bookmark timestamp
        maxDuration?: number;                   // Maximum bookmark timestamp
      };
      
      // CSV-specific options
      csvOptions?: CSVOptions;
      
      // Metadata options
      includeSystemMetadata?: boolean;          // Include system-level metadata
      includePerformanceData?: boolean;         // Include access counts, etc.
      
      // Processing options
      batchSize?: number;                       // Batch processing size
      progressCallback?: (processed: number, total: number) => void;
    }
    ```
    
    #### `ImportOptions` Interface
    
    Configuration for bookmark import operations.
    
    ```typescript
    interface ImportOptions {
      duplicateHandling: 'skip' | 'replace' | 'merge';  // Duplicate resolution strategy
      validateData: boolean;                            // Enable data validation
      preserveIds: boolean;                            // Keep original bookmark IDs
      
      // Validation options
      strictValidation?: boolean;               // Fail on any validation error
      allowPartialImport?: boolean;            // Continue on individual failures
      
      // Field mapping (for CSV imports)
      fieldMapping?: {
        [csvColumn: string]: keyof BookmarkData;
      };
      
      // Data transformation
      transformTitle?: (title: string) => string;
      transformTags?: (tags: string[]) => string[];
      normalizeFilePaths?: boolean;            // Convert to absolute paths
      
      // Processing options
      batchSize?: number;                      // Import batch size
      progressCallback?: (processed: number, total: number) => void;
      
      // Conflict resolution
      conflictResolver?: (existing: BookmarkData, incoming: BookmarkData) => BookmarkData;
    }
    ```
    
    #### `ExportResult` Interface
    
    Result data from export operations.
    
    ```typescript
    interface ExportResult {
      success: boolean;                        // Overall operation success
      filePath: string;                       // Path to exported file
      exportedCount: number;                   // Number of bookmarks exported
      fileSize: number;                       // Size of exported file in bytes
      
      // Processing statistics
      processingTime: number;                  // Export duration in milliseconds
      compressionRatio?: number;               // Compression ratio (if enabled)
      
      // Error information
      error?: string;                         // Error message if failed
      warnings?: string[];                    // Non-fatal warnings
      
      // Export metadata
      exportedAt: string;                     // ISO 8601 export timestamp
      exportFormat: 'json' | 'csv';          // Actual export format used
      
      // Advanced statistics
      statistics?: {
        averageBookmarkSize: number;          // Average bookmark data size
        totalMetadataSize: number;            // Total metadata size
        duplicatesSkipped: number;            // Duplicates excluded during export
      };
    }
    ```
    
    #### `ImportResult` Interface
    
    Result data from import operations.
    
    ```typescript
    interface ImportResult {
      success: boolean;                       // Overall operation success
      importedCount: number;                  // Successfully imported bookmarks
      skippedCount: number;                   // Skipped due to duplicates/filters
      errorCount: number;                     // Failed import attempts
      
      // Detailed results
      duplicates?: number;                    // Duplicate bookmarks found
      errors?: string[];                      // Array of error messages
      warnings?: string[];                    // Non-fatal warnings
      
      // Processing statistics
      processingTime: number;                 // Import duration in milliseconds
      validationTime?: number;                // Time spent on validation
      
      // Import metadata
      importedAt: string;                     // ISO 8601 import timestamp
      sourceFormat: 'json' | 'csv';          // Source file format
      
      // Advanced statistics
      statistics?: {
        averageProcessingTime: number;        // Per-bookmark processing time
        memoryUsage: number;                 // Peak memory usage in bytes
        cacheHitRate: number;                // Cache efficiency during import
      };
    }
    ```
    
    #### `CSVOptions` Interface
    
    CSV-specific export/import configuration.
    
    ```typescript
    interface CSVOptions {
      delimiter: string;                      // Field delimiter (default: ',')
      quote: string;                         // Quote character (default: '"')
      escape: string;                        // Escape character (default: '"')
      lineTerminator: string;                // Line ending (default: '\n')
      
      // Header options
      includeHeader: boolean;                // Include column headers
      customHeaders?: { [field: string]: string };  // Custom header names
      
      // Field formatting
      dateFormat?: string;                   // Date formatting pattern
      numberPrecision?: number;              // Decimal places for numbers
      booleanFormat?: { true: string; false: string };  // Boolean representation
      
      // Array handling
      arrayDelimiter: string;                // Delimiter for array values (default: ';')
      wrapArrays: boolean;                   // Wrap arrays in quotes
      
      // Advanced options
      encoding?: string;                     // Character encoding (default: 'utf8')
      trimWhitespace?: boolean;              // Trim leading/trailing spaces
      skipEmptyLines?: boolean;              // Skip empty rows
    }
    ```
  </Tab>
  
  <Tab value="Configuration">
    ### Configuration & Settings
    
    #### `BookmarkSettings` Interface
    
    User preferences and plugin configuration.
    
    ```typescript
    interface BookmarkSettings {
      // Display preferences
      theme: 'light' | 'dark' | 'auto';         // UI theme preference
      sortBy: 'timestamp' | 'title' | 'created' | 'accessed';  // Default sort order
      sortDirection: 'asc' | 'desc';            // Sort direction
      
      // Behavior settings
      autoSave: boolean;                        // Enable automatic saving
      confirmDelete: boolean;                   // Confirm bookmark deletion
      showTimestamps: boolean;                  // Display timestamp in UI
      
      // Advanced features
      autoTagging: boolean;                     // Enable automatic tag generation
      metadataDetection: boolean;               // Enable metadata auto-population
      duplicateDetection: 'strict' | 'loose';  // Duplicate detection sensitivity
      
      // Performance settings
      cacheSize: number;                        // Maximum cache entries
      debounceDelay: number;                    // Debounce delay in milliseconds
      batchSize: number;                        // Batch processing size
      
      // Export defaults
      defaultExportFormat: 'json' | 'csv';     // Default export format
      includeMetadataByDefault: boolean;        // Include metadata in exports
      
      // UI preferences
      sidebarWidth?: number;                    // Sidebar width in pixels
      showDescriptions: boolean;                // Show descriptions in lists
      compactView: boolean;                     // Use compact list view
      
      // Keyboard shortcuts
      shortcuts?: {
        addBookmark?: string;                   // Shortcut for adding bookmark
        exportBookmarks?: string;               // Shortcut for export dialog
        searchBookmarks?: string;               // Shortcut for search
      };
    }
    ```
    
    #### `FilterPreset` Interface
    
    Saved filter configurations for quick access.
    
    ```typescript
    interface FilterPreset {
      id: string;                              // Unique preset identifier
      name: string;                           // Display name
      description?: string;                   // Optional description
      
      // Filter criteria
      tags?: string[];                        // Required tags
      tagMode?: 'AND' | 'OR';                // Tag matching logic
      searchQuery?: string;                   // Text search query
      
      // Date range filter
      dateRange?: {
        start?: string;                       // ISO 8601 start date
        end?: string;                         // ISO 8601 end date
        relative?: 'today' | 'week' | 'month' | 'year';  // Relative date range
      };
      
      // Duration filter
      durationRange?: {
        min?: number;                         // Minimum timestamp
        max?: number;                         // Maximum timestamp
      };
      
      // Media filter
      mediaTypes?: string[];                  // File extensions or MIME types
      filePatterns?: string[];                // Regex patterns for file paths
      
      // Metadata
      createdAt: string;                      // ISO 8601 creation timestamp
      lastUsed?: string;                      // ISO 8601 last usage timestamp
      usageCount?: number;                    // Number of times applied
    }
    ```
  </Tab>
  
  <Tab value="Performance">
    ### Performance & Caching Types
    
    #### `BookmarkCache` Interface
    
    Internal caching system for performance optimization.
    
    ```typescript
    interface BookmarkCache {
      // Cache entries
      entries: Map<string, CacheEntry<BookmarkData>>;
      
      // Index maps for fast lookup
      idIndex: Map<string, BookmarkData>;           // O(1) lookup by ID
      fileIndex: Map<string, BookmarkData[]>;      // O(1) lookup by file path
      tagIndex: Map<string, Set<string>>;          // O(1) lookup by tag
      
      // Cache statistics
      stats: CacheStats;
      
      // Configuration
      maxSize: number;                             // Maximum cache entries
      ttl: number;                                 // Time-to-live in milliseconds
      
      // Methods
      get(key: string): BookmarkData | undefined;
      set(key: string, value: BookmarkData): void;
      invalidate(key?: string): void;
      clear(): void;
      getStats(): CacheStats;
    }
    ```
    
    #### `CacheEntry<T>` Interface
    
    Individual cache entry with metadata.
    
    ```typescript
    interface CacheEntry<T> {
      value: T;                                    // Cached value
      timestamp: number;                           // Cache entry creation time
      accessCount: number;                         // Number of cache hits
      lastAccessed: number;                        // Last access timestamp
      size: number;                               // Estimated memory size in bytes
    }
    ```
    
    #### `CacheStats` Interface
    
    Cache performance statistics.
    
    ```typescript
    interface CacheStats {
      // Hit/miss statistics
      hits: number;                               // Number of cache hits
      misses: number;                             // Number of cache misses
      hitRate: number;                            // Hit rate percentage (0-1)
      
      // Memory statistics
      totalEntries: number;                       // Total cache entries
      totalSize: number;                          // Total memory usage in bytes
      averageEntrySize: number;                   // Average entry size
      
      // Performance metrics
      averageAccessTime: number;                  // Average access time in milliseconds
      evictionCount: number;                      // Number of entries evicted
      
      // Time-based metrics
      oldestEntry: number;                        // Timestamp of oldest entry
      newestEntry: number;                        // Timestamp of newest entry
      lastEviction?: number;                      // Timestamp of last eviction
    }
    ```
    
    #### `PerformanceMetrics` Interface
    
    System-wide performance tracking.
    
    ```typescript
    interface PerformanceMetrics {
      // Operation timing
      bookmarkOperations: {
        add: { count: number; totalTime: number; averageTime: number; };
        remove: { count: number; totalTime: number; averageTime: number; };
        update: { count: number; totalTime: number; averageTime: number; };
        search: { count: number; totalTime: number; averageTime: number; };
      };
      
      // I/O operations
      fileOperations: {
        save: { count: number; totalTime: number; averageTime: number; };
        load: { count: number; totalTime: number; averageTime: number; };
        export: { count: number; totalTime: number; averageTime: number; };
        import: { count: number; totalTime: number; averageTime: number; };
      };
      
      // Memory usage
      memoryUsage: {
        bookmarkData: number;                     // Memory used by bookmark data
        cacheData: number;                        // Memory used by caches
        totalHeap: number;                        // Total heap usage
        peakUsage: number;                        // Peak memory usage
      };
      
      // System health
      systemHealth: {
        cpuUsage: number;                         // CPU usage percentage
        memoryPressure: number;                   // Memory pressure indicator
        diskSpace: number;                        // Available disk space
        lastHealthCheck: string;                  // ISO 8601 timestamp
      };
    }
    ```
  </Tab>
</Tabs>

## üîß Utility Types

### Event System Types

```typescript
// Event listener types
type BookmarkEventType = 'added' | 'removed' | 'updated' | 'imported' | 'exported';

interface BookmarkEvent {
  type: BookmarkEventType;
  bookmarkId?: string;
  bookmarkData?: BookmarkData;
  timestamp: number;
  source: 'user' | 'system' | 'import';
}

type BookmarkEventListener = (event: BookmarkEvent) => void;

// Message passing types for UI communication
interface UIMessage {
  type: 'refresh' | 'bookmark-added' | 'bookmark-removed' | 'settings-changed';
  data?: any;
  target?: 'sidebar' | 'overlay' | 'window' | 'all';
}
```

### Validation Types

```typescript
// Data validation results
interface ValidationResult {
  valid: boolean;
  errors: ValidationError[];
  warnings: ValidationWarning[];
}

interface ValidationError {
  field: string;
  message: string;
  code: string;
  severity: 'error' | 'warning';
}

interface ValidationWarning {
  field: string;
  message: string;
  suggestion?: string;
}

// Field validators
type FieldValidator<T> = (value: T) => ValidationResult;

interface ValidationSchema {
  id: FieldValidator<string>;
  title: FieldValidator<string>;
  timestamp: FieldValidator<number>;
  description?: FieldValidator<string>;
  tags?: FieldValidator<string[]>;
  filepath: FieldValidator<string>;
}
```

## üéØ Type Guards & Utilities

### Type Guard Functions

```typescript
// Type guard for BookmarkData
function isBookmarkData(obj: any): obj is BookmarkData {
  return (
    typeof obj === 'object' &&
    typeof obj.id === 'string' &&
    typeof obj.title === 'string' &&
    typeof obj.timestamp === 'number' &&
    typeof obj.filepath === 'string' &&
    typeof obj.filename === 'string' &&
    typeof obj.createdAt === 'string' &&
    (obj.description === undefined || typeof obj.description === 'string') &&
    (obj.tags === undefined || Array.isArray(obj.tags)) &&
    (obj.lastModified === undefined || typeof obj.lastModified === 'string')
  );
}

// Type guard for ExportOptions
function isExportOptions(obj: any): obj is ExportOptions {
  return (
    typeof obj === 'object' &&
    (obj.format === 'json' || obj.format === 'csv') &&
    typeof obj.includeMetadata === 'boolean'
  );
}

// Type guard for ImportOptions
function isImportOptions(obj: any): obj is ImportOptions {
  return (
    typeof obj === 'object' &&
    ['skip', 'replace', 'merge'].includes(obj.duplicateHandling) &&
    typeof obj.validateData === 'boolean' &&
    typeof obj.preserveIds === 'boolean'
  );
}
```

### Utility Types

```typescript
// Partial update types
type BookmarkUpdate = Partial<Omit<BookmarkData, 'id' | 'filepath' | 'createdAt'>>;

// Filter types
type SortField = keyof Pick<BookmarkData, 'timestamp' | 'title' | 'createdAt' | 'lastModified'>;
type SortDirection = 'asc' | 'desc';

// Search options
interface SearchOptions {
  query: string;
  fields?: (keyof BookmarkData)[];
  caseSensitive?: boolean;
  exactMatch?: boolean;
  maxResults?: number;
}

// Bulk operation types
interface BulkOperation<T> {
  operation: 'add' | 'update' | 'remove';
  data: T[];
  options?: {
    continueOnError?: boolean;
    batchSize?: number;
    progressCallback?: (processed: number, total: number) => void;
  };
}

type BulkResult<T> = {
  success: boolean;
  processed: number;
  errors: Array<{ index: number; error: string; data: T }>;
  results: T[];
};
```

<Callout type="info" title="TypeScript Version Compatibility">
  These interfaces are designed for **TypeScript 4.5+** and utilize advanced features like:
  - Template literal types
  - Conditional types  
  - Mapped types
  - Type guards with predicates
  - Utility types (`Partial`, `Omit`, `Pick`)
</Callout>

<Cards>
  <Card title="Validation" icon="Shield" href="#validation-types">
    Complete data validation system with error handling and type safety
  </Card>
  <Card title="Performance" icon="Zap" href="#performance--caching-types">
    Advanced caching and performance monitoring interfaces
  </Card>
  <Card title="Events" icon="Bell" href="#event-system-types">
    Event-driven architecture with type-safe event handling
  </Card>
  <Card title="Utilities" icon="Wrench" href="#type-guards--utilities">
    Type guards, validators, and utility functions for robust operation
  </Card>
</Cards>